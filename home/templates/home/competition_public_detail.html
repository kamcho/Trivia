{% extends 'home/competition/base.html' %}

{% block breadcrumb %}
<li class="flex items-center">
    <i class="fas fa-angle-right text-gray-500 mx-2"></i>
    <a href="{% url 'competition_list' %}" class="text-sm font-medium text-gray-400 hover:text-white transition-colors">Competitions</a>
</li>
<li class="flex items-center">
    <i class="fas fa-angle-right text-gray-500 mx-2"></i>
    <span class="text-sm font-medium text-gray-400">{{ competition.name|truncatechars:40 }}</span>
</li>
{% endblock %}

{% block header_title %}{{ competition.name }}{% endblock %}
{% block header_subtitle %}
    {% if competition.description %}{{ competition.description|truncatechars:140 }}{% else %}Competition details{% endif %}
{% endblock %}

{% block header_actions %}
<a href="{% url 'competition_list' %}"
   class="inline-flex items-center px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm font-semibold transition-colors">
    <i class="fas fa-arrow-left mr-2"></i> Back to List
</a>
{% endblock %}

{% block competition_content %}
<div class="grid grid-cols-1 gap-6">
    {% if intro_media %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
            <i class="fas fa-play-circle text-indigo-400 mr-2"></i>
            Introduction
        </h3>
        {% include 'home/partials/_competition_media_item.html' with item=intro_media %}
    </div>
    {% endif %}

    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <div class="flex flex-wrap items-center gap-2 mb-4">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700/50 text-slate-300">
                {{ competition.get_status_display }}
            </span>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700/50 text-slate-300">
                <i class="far fa-calendar-alt mr-1"></i>
                {{ competition.start_date|date:"M d, Y" }} — {{ competition.end_date|date:"M d, Y" }}
            </span>
        </div>
        {% if competition.description %}
        <p class="text-gray-300">{{ competition.description }}</p>
        {% endif %}
    </div>

    {% if eligibility %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
            <i class="fas fa-user-check text-indigo-400 mr-2"></i>
            Eligibility
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm text-gray-300">
            <div>
                <span class="text-gray-400">Allowed Levels:</span>
                <span class="ml-2 text-white">{{ eligibility.get_allowed_levels_display }}</span>
            </div>
            <div>
                <span class="text-gray-400">Participation:</span>
                <span class="ml-2 text-white">{{ eligibility.allowed_participation }}</span>
            </div>
            {% if eligibility.min_age or eligibility.max_age %}
            <div>
                <span class="text-gray-400">Age Range:</span>
                <span class="ml-2 text-white">{{ eligibility.min_age|default:'-' }} - {{ eligibility.max_age|default:'-' }}</span>
            </div>
            {% endif %}
        </div>
        {% if eligibility.prerequisites %}
        <div class="mt-3 text-sm text-gray-300">
            <span class="text-gray-400">Prerequisites:</span>
            <p class="mt-1">{{ eligibility.prerequisites }}</p>
        </div>
        {% endif %}
        {% if eligibility.eligibility_notes %}
        <div class="mt-3 text-sm text-gray-300">
            <span class="text-gray-400">Notes:</span>
            <p class="mt-1">{{ eligibility.eligibility_notes }}</p>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
            <i class="fas fa-tasks text-indigo-400 mr-2"></i>
            Activities
        </h3>
        {% if competition.activities.all %}
        <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {% for activity in competition.activities.all %}
            <li class="bg-slate-800/30 rounded-lg p-3 border border-slate-700/50">
                <div class="flex items-start justify-between">
                    {% if activity.slug %}
                    <a href="{% url 'competitionactivity_detail' slug=activity.slug %}" class="text-white font-medium hover:text-indigo-300">
                        {{ activity.name }}
                    </a>
                    {% else %}
                    <span class="text-white font-medium">{{ activity.name }}</span>
                    {% endif %}
                    <span class="text-xs text-gray-400 self-center">{{ activity.get_activity_type_display|default:'Activity' }}</span>
                </div>
                {% if activity.description %}
                <p class="text-sm text-gray-400 mt-1">{{ activity.description|truncatechars:160 }}</p>
                {% endif %}
                {% if activity.slug %}
                <div class="mt-3 flex justify-end">
                    <a href="{% url 'competitionactivity_detail' slug=activity.slug %}#instructions"
                       class="inline-flex items-center px-3 py-1.5 rounded-md text-xs font-medium bg-indigo-600 hover:bg-indigo-500 text-white transition-colors">
                        <i class="fas fa-eye mr-1"></i>
                        View activity
                    </a>
                </div>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-gray-400">No activities linked yet.</p>
        {% endif %}
    </div>

    {% if registration_windows %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
            <i class="fas fa-door-open text-indigo-400 mr-2"></i>
            Registration
        </h3>
        <div class="space-y-3 text-sm">
            {% for w in registration_windows %}
            <div class="flex items-center justify-between bg-slate-800/30 rounded-lg p-3 border border-slate-700/50">
                <div class="text-gray-300">
                    <i class="far fa-clock mr-1"></i>
                    {{ w.opens_at|date:"M d, Y H:i" }} → {{ w.closes_at|date:"M d, Y H:i" }}
                    {% if w.capacity %}<span class="ml-2 text-xs text-gray-400">Capacity: {{ w.capacity }}</span>{% endif %}
                </div>
                {% if w.fee_amount %}
                <div class="text-indigo-300 font-medium">{{ w.fee_currency }} {{ w.fee_amount }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if schedule_items %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4 flex items="items-center">
            <i class="fas fa-stream text-indigo-400 mr-2"></i>
            Schedule
        </h3>
        <div class="space-y-3 text-sm">
            {% for it in schedule_items %}
            <div class="bg-slate-800/30 rounded-lg p-3 border border-slate-700/50">
                <div class="flex items-center justify-between">
                    <div class="text-white font-medium">{{ it.title }}</div>
                    <div class="text-gray-300"><i class="far fa-clock mr-1"></i>{{ it.start_at|date:"M d, Y H:i" }}{% if it.end_at %} — {{ it.end_at|date:"M d, Y H:i" }}{% endif %}</div>
                </div>
                {% if it.location_hint %}<div class="text-xs text-gray-400 mt-1">{{ it.location_hint }}</div>{% endif %}
                {% if it.description %}<div class="text-sm text-gray-300 mt-2">{{ it.description }}</div>{% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if resources %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4">Resources</h3>
        <ul class="space-y-2 text-sm">
            {% for r in resources %}
            <li class="flex items-center justify-between bg-slate-800/30 rounded-lg p-3 border border-slate-700/50">
                <div class="text-white font-medium">{{ r.title }}</div>
                {% if r.file %}
                <a href="{{ r.file.url }}" class="text-indigo-300 hover:text-indigo-200" target="_blank"><i class="fas fa-download mr-1"></i>Download</a>
                {% elif r.url %}
                <a href="{{ r.url }}" class="text-indigo-300 hover:text-indigo-200" target="_blank"><i class="fas fa-external-link-alt mr-1"></i>Open</a>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if sponsors %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
            <i class="fas fa-handshake text-indigo-400 mr-2"></i>
            Sponsors
        </h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
            {% for s in sponsors %}
            <div class="bg-slate-800/30 rounded-lg p-3 border border-slate-700/50 flex items-center gap-3">
                {% if s.logo %}
                    {% if s.website %}<a href="{{ s.website }}" target="_blank" class="shrink-0">{% endif %}
                    <img src="{{ s.logo.url }}" class="h-10 w-10 object-cover rounded" alt="{{ s.name }}">
                    {% if s.website %}</a>{% endif %}
                {% endif %}
                <div class="min-w-0">
                    <div class="text-white text-sm font-medium truncate">
                        {% if s.website %}<a href="{{ s.website }}" target="_blank" class="hover:text-indigo-300">{{ s.name }}</a>{% else %}{{ s.name }}{% endif %}
                    </div>
                    <div class="text-xs text-gray-400 truncate">{{ s.get_tier_display }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if gallery_media %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
            <i class="fas fa-photo-video text-indigo-400 mr-2"></i>
            Gallery
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {% for item in gallery_media %}
                {% include 'home/partials/_competition_media_item.html' with item=item %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if venues %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4">Venue</h3>
        <div class="space-y-3 text-sm text-gray-300">
            {% for v in venues %}
            <div>
                <div class="text-white font-medium">{{ v.name }}</div>
                {% if v.address %}<div class="text-xs">{{ v.address }}</div>{% endif %}
                <div class="text-xs">{{ v.city }}{% if v.city and v.country %}, {% endif %}{{ v.country }}</div>
                {% if v.map_link %}<a href="{{ v.map_link }}" target="_blank" class="text-indigo-300 hover:text-indigo-200 text-xs"><i class="fas fa-map-marker-alt mr-1"></i>Map</a>{% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if contacts %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4">Contacts</h3>
        <div class="space-y-3 text-sm text-gray-300">
            {% for c in contacts %}
            <div class="flex items-start justify-between">
                <div>
                    <div class="text-white font-medium">{{ c.name }}{% if c.is_primary %} <span class="ml-2 text-xs text-green-300">Primary</span>{% endif %}</div>
                    <div class="text-xs text-gray-400">{{ c.get_role_display }}</div>
                    {% if c.email %}<div class="text-xs"><i class="far fa-envelope mr-1"></i>{{ c.email }}</div>{% endif %}
                    {% if c.phone %}<div class="text-xs"><i class="fas fa-phone mr-1"></i>{{ c.phone }}</div>{% endif %}
                </div>
                <div class="text-xs text-gray-400">{{ c.get_preferred_channel_display }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if social_links %}
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4">Follow</h3>
        <div class="flex flex-wrap gap-2">
            {% for sl in social_links %}
            <a href="{{ sl.url }}" target="_blank" class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-slate-700/50 text-slate-300 hover:bg-slate-600/50 transition-colors">{{ sl.display_name|default:sl.network }}</a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
        <h3 class="text-lg font-semibold text-white mb-4">Meta</h3>
        <div class="space-y-3 text-sm">
            <div class="flex items-center justify-between">
                <span class="text-gray-300">Status</span>
                <span class="text-slate-200">{{ competition.get_status_display }}</span>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-gray-300">Active</span>
                <span class="text-slate-200">{% if competition.is_active %}Yes{% else %}No{% endif %}</span>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-gray-300">Activities</span>
                <span class="text-slate-200">{{ competition.activities.count }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}


