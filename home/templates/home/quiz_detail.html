{% extends 'base.html' %}

{% block title %}{{ quiz.name }} - BibleTrivia{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-8 border border-slate-700/50">
        <div class="flex flex-col md:flex-row md:items-start md:justify-between">
            <div class="flex-1">
                <div class="flex items-center mb-4">
                    <div class="h-16 w-16 rounded-xl bg-indigo-600/20 text-indigo-300 flex items-center justify-center text-2xl mr-4">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white mb-2">{{ quiz.name }}</h1>
                        <p class="text-gray-400">by {{ quiz.created_by.get_full_name|default:quiz.created_by.username }}</p>
                    </div>
                </div>
                
                {% if quiz.description %}
                <p class="text-gray-300 text-lg mb-6">{{ quiz.description }}</p>
                {% endif %}
                
                <!-- Badges -->
                <div class="flex flex-wrap gap-3 mb-6">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                        {% if quiz.difficulty == 'Easy' %}bg-green-900/30 text-green-300
                        {% elif quiz.difficulty == 'Medium' %}bg-yellow-900/30 text-yellow-300
                        {% else %}bg-red-900/30 text-red-300{% endif %}">
                        <i class="fas fa-signal mr-2"></i>
                        {{ quiz.get_difficulty_display }}
                    </span>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-900/30 text-blue-300">
                        <i class="fas fa-tag mr-2"></i>
                        {{ quiz.get_quiz_type_display }}
                    </span>
                    {% if quiz.time_limit %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-900/30 text-purple-300">
                        <i class="fas fa-clock mr-2"></i>
                        {{ quiz.time_limit }} min limit
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="mt-6 md:mt-0 md:ml-6">
                {% if user.is_authenticated %}
                    {% if can_take_quiz %}
                    <a href="{% url 'quiz_take' slug=quiz.slug %}" 
                       class="inline-flex items-center px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-semibold rounded-lg transition-colors mb-3">
                        <i class="fas fa-play mr-2"></i>
                        Take Quiz
                    </a>
                    {% else %}
                    <div class="inline-flex items-center px-6 py-3 bg-slate-600 text-slate-300 font-semibold rounded-lg mb-3">
                        <i class="fas fa-lock mr-2"></i>
                        Not available
                    </div>
                    {% endif %}
                {% else %}
                    {% if quiz.is_public and quiz.is_active %}
                    <a href="{% url 'quiz_take' slug=quiz.slug %}"
                       class="inline-flex items-center px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-semibold rounded-lg transition-colors mb-1">
                        <i class="fas fa-user-secret mr-2"></i>
                        Take as Guest
                    </a>
                    <div class="text-xs text-slate-300 mb-3">Your progress wonâ€™t be saved. <a href="/accounts/signup/" class="text-indigo-400 hover:text-indigo-300 underline">Sign up</a> to save attempts and join group challenges.</div>
                    {% else %}
                    <div class="inline-flex items-center px-6 py-3 bg-slate-600 text-slate-300 font-semibold rounded-lg mb-3">
                        <i class="fas fa-lock mr-2"></i>
                        Login Required
                    </div>
                    {% endif %}
                {% endif %}
                {% if user.is_authenticated and user.role == 'Admin' %}
                <a href="{% url 'quiz_manage_questions' slug=quiz.slug %}"
                   class="inline-flex items-center px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white font-medium rounded-lg transition-colors mb-3">
                    <i class="fas fa-list-check mr-2"></i>
                    Manage Questions
                </a>
                {% endif %}
                <a href="{% url 'quiz_list' %}" 
                   class="inline-flex items-center px-4 py-2 border border-slate-600 text-slate-300 font-medium rounded-lg hover:bg-slate-700/50 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to Quizzes
                </a>
            </div>
        </div>
    </div>

    <!-- Quiz Information -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Instructions -->
            {% if quiz.instructions %}
            <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
                <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                    <i class="fas fa-info-circle text-indigo-400 mr-3"></i>
                    Instructions
                </h2>
                <div class="prose prose-invert max-w-none">
                    <p class="text-gray-300 whitespace-pre-line">{{ quiz.instructions }}</p>
                </div>
            </div>
            {% endif %}
            
            <!-- Sample Questions -->
            {% if questions %}
            <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
                <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                    <i class="fas fa-eye text-indigo-400 mr-3"></i>
                    Sample Questions
                </h2>
                <div class="space-y-4">
                    {% for question in questions %}
                    <div class="bg-slate-800/30 rounded-lg p-4 border border-slate-700/50">
                        <h3 class="text-white font-medium mb-2">{{ forloop.counter }}. {{ question.question_text }}</h3>
                        <div class="space-y-2">
                            {% for choice in question.choices.all %}
                            <div class="flex items-center text-sm text-gray-300">
                                <span class="w-4 h-4 rounded-full border border-slate-600 mr-3 flex-shrink-0"></span>
                                {{ choice.choice_text }}
                                {% if choice.is_correct %}
                                <i class="fas fa-check text-green-400 ml-2"></i>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if quiz.get_question_count > 5 %}
                <p class="text-sm text-gray-400 mt-4">
                    ... and {{ quiz.get_question_count|add:"-5" }} more question{{ quiz.get_question_count|add:"-5"|pluralize }}
                </p>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Quiz Stats -->
            <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
                <h3 class="text-lg font-semibold text-white mb-4">Quiz Details</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Questions</span>
                        <span class="text-white font-medium">{{ question_count }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Duration</span>
                        <span class="text-white font-medium">{{ estimated_duration }} min</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Total Points</span>
                        <span class="text-white font-medium">{{ total_points }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Passing Score</span>
                        <span class="text-white font-medium">{{ quiz.passing_score }}%</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Max Attempts</span>
                        <span class="text-white font-medium">{{ quiz.max_attempts }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Quiz Settings -->
            <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
                <h3 class="text-lg font-semibold text-white mb-4">Settings</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Public</span>
                        <span class="text-white">
                            {% if quiz.is_public %}
                            <i class="fas fa-check text-green-400"></i>
                            {% else %}
                            <i class="fas fa-times text-red-400"></i>
                            {% endif %}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Active</span>
                        <span class="text-white">
                            {% if quiz.is_active %}
                            <i class="fas fa-check text-green-400"></i>
                            {% else %}
                            <i class="fas fa-times text-red-400"></i>
                            {% endif %}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Auth Required</span>
                        <span class="text-white">
                            {% if quiz.requires_authentication %}
                            <i class="fas fa-check text-green-400"></i>
                            {% else %}
                            <i class="fas fa-times text-red-400"></i>
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Creator Info -->
            <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700/50">
                <h3 class="text-lg font-semibold text-white mb-4">Created By</h3>
                <div class="flex items-center">
                    <div class="h-10 w-10 rounded-full bg-indigo-600/20 text-indigo-300 flex items-center justify-center mr-3">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <p class="text-white font-medium">{{ quiz.created_by.get_full_name|default:quiz.created_by.username }}</p>
                        <p class="text-sm text-gray-400">{{ quiz.created_at|date:"M d, Y" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

